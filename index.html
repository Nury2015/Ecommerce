<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Página principal</title>
    <link rel="stylesheet" href="index.css">
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300..700&display=swap" rel="stylesheet">
</head>

<body>
    <nav>
        <a href="menumobile.html">
    
            <img src="icons/icon_menu.svg" alt="menu" class="menu">
        </a>
    
    
        <div class="navbar-left">
            <a href="index.html">
                <img src="logos/logo_yard_sale.svg" alt="logo" class="logo">
            </a>
    
            <ul>
                <li>
                    <a href="Misordenes.html">
                        Tus pedidos
                    </a>
                </li>
    
                <li>
                    <a href="index.html">Clothes</a>
                </li>
    
                <li>
                    <a href="index.html">Electronics</a>
                </li>
    
                <li>
                    <a href="index.html">Furnitures</a>
                </li>
    
                <li>
                    <a href="index.html">Toys</a>
                </li>
    
                <li>
                    <a href="index.html">Others</a>
                </li>
            </ul>
        </div>
    
        <div class="navbar-right">
            <ul>
    
                <li class="navbar-email">
                    <a href="editar-cuenta.html">
                        camila@gmail.com
                    </a>
                </li>
    
                <li class="navbar-shopping-cart">
                    <a id="ver-carrito">
                        <img src="icons/icon_shopping_cart.svg" alt="shopping cart">
                        <div>0</div>
                    </a>
                </li>
            </ul>
        </div>
    </nav>

    <section class="main-container">
        <div class="card-container" id="card-container">
        </div>
    </section>

    <footer>
        © <span id="year"></span> DECAYBA · Hecho con ❤
    </footer>

    <script>
const cartContent = document.getElementById('card-container');
        const productos = [
            {
                nombre: "Peluche para perro",
                valor: "$50.000",
                imagen: "img/peluche/perrocon.webp"
            },
            {
                nombre: "Botón para perros",
                valor: "$50.000",
                imagen: "img/Boton/principal.webp"
            },
            {
                nombre: "Cepillo para mascotas",
                valor: "40.000",
                imagen: "img/Cepillo para mascotas/principal.webp"
            },
            {
                nombre: "Avión",
                valor: "$120.000",
                imagen: "img/ganzo/principal.webp"
            },
            {
                nombre: "Distribuidor de Bolsas",
                valor: "$30.000",
                imagen: "img/contenedorbolsa/princi.webp"
            },
            {
                nombre: "Juguetes de pelota para perros",
                valor: "$40.000",
                imagen: "img/Pelotas/Principal.webp"
            },
            {
                nombre: "Entrenador de Baño para Perros",
                valor: "$50.000",
                imagen: "img/tepete/principal.webp"
            },
            {
                nombre: "Disco Volador De Entrenamiento Para Mascotas",
                valor: "$30.000",
                imagen: "img/frisbi/principal.webp"
            },
            {
                nombre: "Bolsa de entrenamiento",
                valor: "$40.000",
                imagen: "img/Bolsa/principal.webp"
            },
            {
                nombre: "Peine para Mascota",
                valor: "$30.000",
                imagen: "img/Cepillo/princi.webp"
            },
            {
                nombre: "Disco Volador",
                valor: "$40.000",
                imagen: "img/Disco volador/principal.webp"
            },
            {
                nombre: "Comedero para perro",
                valor: "$100.000",
                imagen: "img/comedero/negro.webp"
            },
            {
                nombre: "Juguetes para Masticar con Sonido para Cachorros",
                valor: "$50.000",
                imagen: "img/Pelotas/Principal.webp"
            },
            {
                nombre: "Bolsas para Excrementos de Perro",
                valor: "$40.000",
                imagen: "img/bolsas/principal.webp"
            },
            {
                nombre: "Bálsamo Hidratante huellas y nariz",
                valor: "$10.000",
                imagen: "img/balsamo/principal.webp"
            },
            {
                nombre: "Cepillo de dientes para mascotas",
                valor: "$20.000",
                imagen: "img/cepillodientes/principal.webp"
            }
        ];

        function renderCart() {
            productos.forEach((item, index) => {

                const div = document.createElement('div');
                div.classList.add('product-card');
                div.innerHTML = `
                <a href="detalleprod.html">
                    <img src="${item.imagen}" alt="${item.nombre}">
                </a>
                <div class="informacion-producto">
                    <div>
                        <p>${item.nombre}</p>
                        <p>${item.valor}</p>
                    </div>
                    <figure>
                        <a href="carrito.html">
                            <img src="icons/bt_add_to_cart.svg" alt="carrito de compra">
                        </a>
                    </figure>
                </div>
            `;
                console.log(div)
            cartContent.appendChild(div);
            })
        }

        renderCart()

        // ⇢ 1. Función que recorre todas las tarjetas y arma la lista
        function obtenerListaDeProductos() {
            // Selecciona TODAS las tarjetas dentro de .card-container
            return Array.from(
                document.querySelectorAll('.card-container .product-card')
            ).map(card => {
                // Imagen principal (la primera dentro del <a>)
                const img = card.querySelector('a img')?.src || '';

                // Nombre (primer <p> dentro de .informacion-producto)
                const nombre = card
                    .querySelector('.informacion-producto p:nth-child(1)')
                    .textContent.trim();

                // Precio (segundo <p> → quitamos símbolos y puntos)
                const precioTexto = card.querySelector(
                    '.informacion-producto p:nth-child(2)'
                ).textContent;
                const precio = Number(precioTexto.replace(/[^0-9]/g, ''));

                return { img, nombre, precio };
            });
        }

        document.getElementById("ver-carrito").addEventListener("click", function (e) {
            e.preventDefault(); // Detiene el comportamiento por defecto del enlace
            const productos = obtenerListaDeProductos();
            console.log(productos);
            localStorage.setItem('productosDisponibles', JSON.stringify(productos));
            window.location.href = "carrito.html"; // Navega manualmente
        });
        // Simulación de carrito
        let carrito = JSON.parse(localStorage.getItem("carrito")) || [];

        function actualizarCarritoVisual() {
            const cartCountDiv = document.querySelector('.navbar-shopping-cart div');
            const totalItems = carrito.reduce((acc, item) => acc + item.cantidad, 0);
            cartCountDiv.textContent = totalItems;
        }

        function agregarAlCarrito(nombre, precio, img) {
            console.log(nombre, precio, img)
            const productoExistente = carrito.find(item => item.nombre === nombre);
            if (productoExistente) {
                productoExistente.cantidad += 1;
            } else {
                carrito.push({ nombre, precio, cantidad: 1, img });
            }

            localStorage.setItem("carrito", JSON.stringify(carrito));
            actualizarCarritoVisual();
        }

        function volarAlCarrito(imgOrigen) {
            const carritoIcono = document.querySelector('.navbar-shopping-cart img');
            const imgRect = imgOrigen.getBoundingClientRect();
            const carritoRect = carritoIcono.getBoundingClientRect();

            const imgClone = imgOrigen.cloneNode(true);
            imgClone.classList.add('fly-img');
            document.body.appendChild(imgClone);

            // Posición inicial (donde está la imagen original)
            imgClone.style.top = imgRect.top + 'px';
            imgClone.style.left = imgRect.left + 'px';

            // Forzamos reflow para que el navegador note la posición inicial
            imgClone.offsetWidth;

            // Posición final (el carrito)
            const translateX = carritoRect.left - imgRect.left;
            const translateY = carritoRect.top - imgRect.top;

            imgClone.style.transform = `translate(${translateX}px, ${translateY}px)`;
            imgClone.style.opacity = 0;

            // Eliminar después de la animación
            setTimeout(() => {
                imgClone.remove();
            }, 700);
        }


        document.querySelectorAll('.product-card').forEach(card => {
            card.querySelector('figure a').addEventListener('click', e => {
                e.preventDefault(); // Evita que redirija
                const nombre = card.querySelector('.informacion-producto p:nth-child(1)').textContent;
                const precioTexto = card.querySelector('.informacion-producto p:nth-child(2)').textContent;
                const precio = Number(precioTexto.replace(/[^0-9]/g, '')); // $120.000 → 120000

                const imgElement = card.querySelector("img"); // Usamos la imagen del producto
                const src = imgElement.src;
                volarAlCarrito(imgElement); // 🎯 ¡Aquí ocurre la magia!

                agregarAlCarrito(nombre, precio, src);
            });
        });

        actualizarCarritoVisual();
    </script>

</body>

</html>